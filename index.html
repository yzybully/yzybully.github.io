<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YZYPlayer BETA SITE</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet" />
<style>
:root { --bg:#0a0a0a; --muted:#161616; --muted2:#1f1f1f; --text:#fff; --text2:#bdbdbd; --acc:#fff; --card:#111; --shadow:0 12px 30px rgba(0,0,0,.35); }
* { box-sizing:border-box; }
html,body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family:"IBM Plex Mono", monospace; text-transform:uppercase; letter-spacing:.06em; }
a { color:inherit; text-decoration:none; }
.app { display:grid; grid-template-columns:280px 1fr; height:100dvh; }
.sidebar { background:linear-gradient(180deg, #0e0e0e, #070707); border-right:1px solid #111; padding:22px 16px; display:flex; flex-direction:column; gap:18px; }
.brand { font-size:22px; font-weight:600; letter-spacing:.18em; }
.muted { color:var(--text2); font-size:11px; margin-top:2px; }
.nav { display:flex; flex-direction:column; gap:10px; margin-top:18px; }
.btn { display:flex; align-items:center; gap:10px; padding:12px 14px; background:var(--muted); border:1px solid #191919; border-radius:14px; cursor:pointer; transition:.25s transform,.25s background,.25s border-color; font-size:12px; color:var(--text);}
.btn:hover { transform:translateY(-2px); background:var(--muted2); border-color:#242424; }
.btn.active { outline:1px solid #2b2b2b; background:#131313; }
.main { position:relative; overflow:hidden; }
.page { position:absolute; inset:0; padding:24px; overflow:auto; opacity:0; transform:translateY(8px); pointer-events:none; transition:opacity .35s ease, transform .35s ease; }
.page.show { opacity:1; transform:none; pointer-events:auto; }
.grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(160px,1fr)); gap:16px; }
.section { margin-bottom:28px; }
.section h2 { font-size:14px; color:var(--text2); margin:0 0 12px; letter-spacing:.12em; }
.card { background:var(--card); border:1px solid #171717; border-radius:18px; padding:14px; box-shadow:var(--shadow); transition:transform .25s ease, border-color .25s ease; display:flex; flex-direction:column; gap:10px; cursor:pointer;}
.card:hover { transform:translateY(-4px); border-color:#242424; }
.cover { width:100%; aspect-ratio:1/1; border-radius:14px; object-fit:cover; background:#0d0d0d; }
.title { font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.subtitle { font-size:11px; color:var(--text2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.card-row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
.like { width:28px; height:28px; border-radius:50%; border:1px solid #222; background:#141414; display:grid; place-items:center; cursor:pointer; transition:.2s; }
.like.active { background:#1c1c1c; border-color:#2a2a2a; }
.like svg { width:14px; height:14px; }
.player { position:fixed; left:280px; right:0; bottom:0; background:linear-gradient(180deg,#0c0c0c,#050505); border-top:1px solid #171717; display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:10px; padding:12px 18px; z-index:5; }
.track { display:flex; align-items:center; gap:12px; min-width:0; }
.track img { width:44px; height:44px; border-radius:10px; border:1px solid #1a1a1a; object-fit:cover; }
.track .meta { min-width:0; }
.controls { display:flex; align-items:center; gap:10px; }
.ctl { width:38px; height:38px; border-radius:12px; border:1px solid #212121; background:#121212; display:grid; place-items:center; cursor:pointer; transition:.2s; color:var(--text);}
.ctl:hover { transform:translateY(-2px); }
.progress { display:flex; align-items:center; gap:10px; padding:0 8px; }
.range { -webkit-appearance:none; appearance:none; height:4px; width:32vw; background:#1a1a1a; border-radius:999px; outline:none; }
.range::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:14px; height:14px; border-radius:50%; background:#fff; cursor:pointer; }
.vol { width:120px; }
.login, .admin { max-width:680px; margin:0 auto; background:var(--card); border:1px solid #171717; border-radius:18px; padding:18px; box-shadow:var(--shadow); }
.row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.field { display:flex; flex-direction:column; gap:8px; }
input, select, textarea { background:#0e0e0e; border:1px solid #1a1a1a; border-radius:12px; padding:12px 12px; color:var(--text); outline:none; transition:.2s; font-family:"IBM Plex Mono", monospace; text-transform:uppercase; }
input:focus, select:focus, textarea:focus { border-color:#2a2a2a; }
.submit { margin-top:10px; width:100%; padding:12px; border-radius:14px; background:#151515; border:1px solid #222; cursor:pointer; font-size:12px; color:var(--text);}
.ghost { background:#101010; }
.hint { color:var(--text2); font-size:11px; margin-top:6px; }
.empty { color:var(--text2); text-align:center; padding:60px 10px; font-size:12px; }
.spacer { height:84px; }

/* Album detail styles (keeps layout; only affects injected detail section) */
.album-detail { display:grid; grid-template-columns:260px 1fr; gap:20px; align-items:start; }
.album-cover { width:100%; border-radius:16px; border:1px solid #1a1a1a; background:#0d0d0d; object-fit:cover; }
.track-list { margin-top:6px; border:1px solid #171717; border-radius:16px; overflow:hidden; }
.track-row { display:grid; grid-template-columns:42px 1fr 64px; align-items:center; padding:10px 14px; border-bottom:1px solid #191919; }
.track-row:last-child { border-bottom:none; }
.track-num { color:var(--text2); text-align:right; padding-right:8px; }
.track-name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.track-dur { color:var(--text2); text-align:right; }
.track-row:hover { background:#131313; cursor:pointer; }

@media (max-width: 900px) {
  .app { grid-template-columns:1fr; }
  .sidebar { position:fixed; inset:auto 0 0 0; flex-direction:row; align-items:center; z-index:10; border-right:0; border-top:1px solid #111; padding:8px; gap:8px; }
  .brand, .muted { display:none; }
  .nav { flex-direction:row; width:100%; margin:0; }
  .btn { flex:1; justify-content:center; }
  .player { left:0; }
  .page { padding-bottom:120px; }
  .album-detail { grid-template-columns:1fr; }
  .track-row { grid-template-columns:34px 1fr 54px; }
}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div>
      <div class="brand">YZYPLAYER</div>
      <div class="muted">HTTPS://DISCORD.GG/5QC4NQMPDV</div>
    </div>
    <nav class="nav">
      <a href="#home" class="btn" data-route="home">HOME</a>
      <a href="#profile" class="btn" data-route="profile">PROFILE</a>
      <a href="#liked" class="btn" data-route="liked">LIKED SONGS</a>
      <a href="#admin" class="btn" data-route="admin">ADMIN PANEL</a>
    </nav>
  </aside>
  <main class="main">
    <section id="home" class="page show">
      <div class="section"><h2>ALBUMS</h2><div id="albums" class="grid"></div></div>
      <div class="section"><h2>EPS</h2><div id="eps" class="grid"></div></div>
      <div class="section"><h2>SINGLES</h2><div id="singles" class="grid"></div></div>
      <div class="spacer"></div>
    </section>
    <section id="profile" class="page"><div class="empty">COMING SOON</div></section>
    <section id="liked" class="page"><div id="likedGrid" class="grid"></div><div class="spacer"></div></section>
    <section id="admin" class="page">
      <div id="adminGate" class="login">
        <div class="field">
          <label>EMAIL</label>
          <input id="email" type="email" placeholder="ENTER ADMIN EMAIL" />
        </div>
        <div class="field">
          <label>PASSWORD</label>
          <input id="password" type="password" placeholder="ENTER PASSWORD" />
        </div>
        <button id="login" class="submit">LOGIN</button>
        <div class="hint">SUPABASE AUTH REQUIRED</div>
      </div>
      <div id="adminDenied" class="login" style="display:none;">
        <div class="empty">ACCESS DENIED — NOT AN ADMIN USER</div>
      </div>
      <div id="adminPanel" class="admin" style="display:none;">
        <div class="field">
          <label>Title</label>
          <input id="title" type="text" placeholder="Album/EP/Single Title" />
        </div>
        <div class="field">
          <label>Cover URL</label>
          <input id="cover" type="text" placeholder="https://..." />
        </div>
        <div class="field">
          <label>Type</label>
          <select id="type">
            <option value="album">ALBUM</option>
            <option value="ep">EP</option>
            <option value="single">SINGLE</option>
          </select>
        </div>
        <div id="tracksContainer"></div>
        <button id="addTrack" class="submit">ADD TRACK</button>
        <button id="submitRelease" class="submit">SUBMIT</button>
      </div>
    </section>
  </main>
</div>

<div class="player">
  <div class="track">
    <img src="" id="trackCover" />
    <div class="meta">
      <div id="trackTitle">Title</div>
      <div id="trackArtist">Artist</div>
    </div>
  </div>
  <div class="controls">
    <div class="ctl" id="prev">&#9664;</div>
    <div class="ctl" id="play">&#9654;</div>
    <div class="ctl" id="next">&#9654;&#9654;</div>
  </div>
  <div class="progress">
    <input type="range" class="range" id="progress" min="0" max="100" value="0" />
    <input type="range" class="range vol" id="volume" min="0" max="100" value="80" />
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://mxprbsynyakkwdnpdmpr.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14cHJic3lueWFra3dkbnBkbXByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMTExODUsImV4cCI6MjA3MDY4NzE4NX0.TCoRg7UcjT8kjHB0ltNiKN3IIFzFXfK5JvMy7PBfocA'
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

const adminUIDs = [
  '1b2383d0-9844-4eb0-8a01-ae5f184c1f12',
  'b276784d-19b6-44bc-bd67-264ebff7f812',
  'f6a5e484-67b0-4277-9e21-c9a32d9664a3'
]

const pages = document.querySelectorAll('.page')
const navBtns = document.querySelectorAll('.btn')

function showPage(route){
  pages.forEach(p=>p.classList.toggle('show', p.id===route))
  navBtns.forEach(b=>b.classList.toggle('active', b.dataset.route===route))
}

navBtns.forEach(btn=>{
  btn.addEventListener('click', e=>{
    e.preventDefault()
    const route = btn.dataset.route
    location.hash = route
    handleRoute(route)
  })
})

async function handleRoute(route){
  if(route === 'admin'){
    await renderAdminView()
    showPage('admin')  // Always show Admin page; inner view decides (login/denied/panel)
  } else {
    showPage(route)
  }
}

function nav(){
  const route = (location.hash.replace('#','') || 'home')
  handleRoute(route)
}
window.addEventListener('hashchange', nav)
nav()

let releases = [], audio = new Audio()
const state = { queue: [], current: -1 }

function formatDuration(sec){
  if(!isFinite(sec)) return '0:00'
  const m = Math.floor(sec/60)
  const s = Math.floor(sec%60).toString().padStart(2,'0')
  return `${m}:${s}`
}

async function fetchReleases(){
  const { data } = await supabase.from('releases').select('*').order('id',{ascending:true})
  releases = data || []
  renderReleases()
}

function renderReleases(){
  const albumsGrid = document.getElementById('albums')
  const epsGrid = document.getElementById('eps')
  const singlesGrid = document.getElementById('singles')
  albumsGrid.innerHTML=''; epsGrid.innerHTML=''; singlesGrid.innerHTML=''

  releases.forEach(r=>{
    const card = document.createElement('div')
    card.className='card'
    card.innerHTML=`<img class="cover" src="${r.cover}" alt="">
      <div class="title">${r.title}</div>
      <div class="subtitle">${(r.type||'').toUpperCase()}</div>`
    card.addEventListener('click', ()=>{
      if(r.tracks && r.tracks.length>1){
        renderTracksPage(r)
      } else if(r.tracks && r.tracks[0]){
        playTrack({ ...r.tracks[0], cover: r.cover, artist: r.artist || '' })
      }
    })
    if(r.type==='album') albumsGrid.appendChild(card)
    else if(r.type==='ep') epsGrid.appendChild(card)
    else singlesGrid.appendChild(card)
  })
}

function renderTracksPage(album){
  const main = document.querySelector('.main')
  const temp = document.createElement('section')
  temp.className='page show'
  const safeCover = album.cover || ''
  temp.innerHTML = `
    <div class="section">
      <h2>${album.title}</h2>
      <div class="album-detail">
        <img class="album-cover" src="${safeCover}" alt="">
        <div class="track-list">
          ${album.tracks.map((t,i)=>`
            <div class="track-row" data-index="${i}">
              <div class="track-num">${i+1}</div>
              <div class="track-name">${t.title}</div>
              <div class="track-dur">${formatDuration(t.duration)}</div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `
  Array.from(document.querySelectorAll('.page')).forEach(p=>p.classList.remove('show'))
  main.appendChild(temp)

  const rows = temp.querySelectorAll('.track-row')
  rows.forEach(row=>{
    row.addEventListener('click', ()=>{
      const idx = Number(row.getAttribute('data-index'))
      const queue = album.tracks.map(tr=>({
        title: tr.title,
        url: tr.url,
        duration: tr.duration,
        artist: album.artist || '',
        cover: album.cover || ''
      }))
      state.queue = queue
      state.current = Math.max(0, idx)
      setNow(state.queue[state.current])
    })
  })
  temp.scrollIntoView({behavior:'smooth'})
}

function playTrack(track){
  setNow(track)
}

function setNow(item){
  if(!item) return
  document.getElementById('trackCover').src = item.cover || ''
  document.getElementById('trackTitle').innerText = item.title || ''
  document.getElementById('trackArtist').innerText = item.artist || ''
  audio.src = item.url || ''
  audio.play()
  document.getElementById('play').innerText='❚❚'
}

document.getElementById('play').addEventListener('click',()=>{
  if(audio.paused) audio.play(); else audio.pause()
  document.getElementById('play').innerText=audio.paused?'▶':'❚❚'
})
document.getElementById('next').addEventListener('click',()=>{
  if(state.queue.length<1) return
  state.current = Math.min(state.queue.length-1, state.current+1)
  setNow(state.queue[state.current])
})
document.getElementById('prev').addEventListener('click',()=>{
  if(state.queue.length<1) return
  state.current = Math.max(0, state.current-1)
  setNow(state.queue[state.current])
})
audio.addEventListener('ended',()=>document.getElementById('play').innerText='▶')
document.getElementById('volume').addEventListener('input',(e)=>{ audio.volume=e.target.value/100 })
document.getElementById('progress').addEventListener('input',(e)=>{ audio.currentTime=e.target.value })
audio.addEventListener('timeupdate',()=>{
  document.getElementById('progress').value=audio.currentTime
  document.getElementById('progress').max=audio.duration||0
})

const loginBtn = document.getElementById('login')
const adminGate = document.getElementById('adminGate')
const adminDenied = document.getElementById('adminDenied')
const adminPanel = document.getElementById('adminPanel')

async function renderAdminView(){
  adminGate.style.display='block'
  adminDenied.style.display='none'
  adminPanel.style.display='none'

  const { data } = await supabase.auth.getUser()
  const user = data?.user
  if(!user){ return } // show login
  if(!adminUIDs.includes(user.id)){
    adminGate.style.display='none'
    adminDenied.style.display='block'
    return
  }
  adminGate.style.display='none'
  adminDenied.style.display='none'
  adminPanel.style.display='block'
}

loginBtn.addEventListener('click', async ()=>{
  const email = document.getElementById('email').value.trim()
  const password = document.getElementById('password').value.trim()
  const { error } = await supabase.auth.signInWithPassword({ email, password })
  if(error){ alert('Login failed'); return }
  await renderAdminView()
  showPage('admin')
})

supabase.auth.onAuthStateChange((_event, _session)=>{
  if((location.hash.replace('#','')||'home')==='admin'){
    renderAdminView()
  }
})

const addTrackBtn = document.getElementById('addTrack')
const tracksContainer = document.getElementById('tracksContainer')
const submitReleaseBtn = document.getElementById('submitRelease')

addTrackBtn.addEventListener('click', ()=>{
  const trackDiv = document.createElement('div')
  trackDiv.className='row'
  trackDiv.innerHTML=`<input type="text" placeholder="Track Title" class="trackTitle"/>
  <input type="text" placeholder="Track URL" class="trackURL"/>
  <input type="number" placeholder="Duration (sec)" class="trackDuration"/>`
  tracksContainer.appendChild(trackDiv)
})

submitReleaseBtn.addEventListener('click', async ()=>{
  const { data: userData } = await supabase.auth.getUser()
  const user = userData?.user
  if(!user || !adminUIDs.includes(user.id)){ alert('Not authorized'); return }

  const title = document.getElementById('title').value
  const cover = document.getElementById('cover').value
  const type = document.getElementById('type').value
  const tracksEls = tracksContainer.querySelectorAll('.row')
  const tracks = Array.from(tracksEls).map(r=>({
    title: r.querySelector('.trackTitle').value,
    url: r.querySelector('.trackURL').value,
    duration: parseInt(r.querySelector('.trackDuration').value||'0',10)
  }))
  const { error } = await supabase.from('releases').insert([{ title, cover, type, tracks }])
  if(error){ alert('Error adding release: '+error.message) }
  else { alert('Release added'); tracksContainer.innerHTML=''; fetchReleases() }
})

fetchReleases()
</script>
</body>
</html>
