<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YZY Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-color: #000;
      --text-color: #fff;
      --accent-color: #999;
      --accent-hover: #fff;
      --progress-bg: #282828;
      --progress-fill: #fff; /* Changed from Spotify green to white */
      --player-bg: #181818;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'IBM Plex Mono', monospace !important;
      user-select: none;
    }

    body {
      display: flex;
      background-color: var(--bg-color);
      color: var(--text-color);
      height: 100vh;
      overflow: hidden;
      flex-direction: row;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: #0a0a0a;
      padding: 20px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #111;
      font-family: 'IBM Plex Mono', monospace;
    }

    .sidebar h1 {
      font-size: 28px;
      margin-bottom: 4px;
    }

    .sidebar small {
      font-size: 12px;
      color: var(--accent-color);
    }

    .nav-btn {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .nav-btn button {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 16px;
      text-align: left;
      cursor: pointer;
      padding: 8px 0;
      transition: color 0.3s ease;
      font-family: 'IBM Plex Mono', monospace;
    }

    .nav-btn button:hover {
      color: var(--accent-hover);
    }

    /* Content */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      position: relative;
      margin-bottom: 110px; /* space for player bar */
      scrollbar-width: none; /* Firefox */
    }
    .content::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }

    .page {
      opacity: 0;
      transform: translateY(10px);
      position: absolute;
      width: 100%;
      transition: opacity 0.4s ease, transform 0.4s ease;
      font-family: 'IBM Plex Mono', monospace;
      background-color: var(--bg-color);
      min-height: 100%;
      padding-bottom: 50px;
    }

    .page.active {
      opacity: 1;
      transform: translateY(0);
      position: relative;
    }

    /* Centered Square Modal */
    .center-box {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      width: 400px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-family: 'IBM Plex Mono', monospace;
    }

    .center-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      font-family: 'IBM Plex Mono', monospace;
    }

    .center-box input,
    .center-box select {
      background: #000;
      border: 1px solid #333;
      color: #fff;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      font-family: 'IBM Plex Mono', monospace;
    }

    .center-box button {
      background: #1db954;
      color: #000;
      padding: 10px;
      border: none;
      cursor: pointer;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      transition: background-color 0.3s ease;
      font-family: 'IBM Plex Mono', monospace;
    }

    .center-box button:hover {
      background: #1ed760;
    }

    /* Song Cards */
    .song-card {
      background: #111;
      padding: 10px;
      border-radius: 8px;
      display: inline-block;
      width: 150px;
      margin: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-family: 'IBM Plex Mono', monospace;
    }

    .song-card:hover {
      background: #1a1a1a;
    }

    .song-card img {
      width: 100%;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .song-card .artist-name {
      font-size: 12px;
      color: var(--accent-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Player Bar */
    .player-bar {
      position: fixed;
      bottom: 0;
      left: 220px;
      right: 0;
      height: 110px;
      background: var(--player-bg);
      border-top: 1px solid #282828;
      display: flex;
      flex-direction: column;
      padding: 10px 30px;
      font-family: 'IBM Plex Mono', monospace;
      user-select: none;
      z-index: 1000;
      color: #b3b3b3;
    }

    .player-top-row {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      padding-bottom: 10px;
      gap: 15px;
    }

    /* Left side container with skip back + track info */
    .left-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
    }

    /* Skip back and track info in one row */
    .skip-back {
      font-size: 32px;
      cursor: pointer;
      background: none;
      border: none;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.25s ease;
      flex-shrink: 0;
    }
    .skip-back:hover {
      color: #1db954;
    }

    .track-info-short {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
      cursor: default;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track-info-short img {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .track-info-text {
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .track-info-text .track-name {
      font-weight: 600;
      font-size: 14px;
      color: white;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-info-text .artist-name {
      font-size: 12px;
      color: var(--accent-color);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Play/Pause button absolute center */
    .play-pause-container {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }

    .play-pause-btn {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 48px;
      cursor: pointer;
      transition: color 0.25s ease;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    .play-pause-btn:hover {
      color: #1db954;
    }

    /* Skip forward on the right */
    .skip-forward {
      font-size: 32px;
      cursor: pointer;
      background: none;
      border: none;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.25s ease;
      flex-shrink: 0;
      margin-left: auto;
    }
    .skip-forward:hover {
      color: #1db954;
    }

    .player-bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .progress-container {
      flex: 1;
      height: 6px;
      background: var(--progress-bg);
      border-radius: 3px;
      cursor: pointer;
      position: relative;
      user-select: none;
      margin-right: 10px;
    }

    .progress-filled {
      background: var(--progress-fill);
      height: 100%;
      width: 0%;
      border-radius: 3px;
      transition: width 0.1s linear;
    }

    .volume-container {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-color);
      cursor: pointer;
      width: 120px;
      justify-content: flex-end;
    }

    .volume-slider {
      width: 100px;
      -webkit-appearance: none;
      height: 6px;
      background: var(--progress-bg);
      border-radius: 3px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #1db954;
      cursor: pointer;
      border-radius: 50%;
      border: none;
      transition: background-color 0.3s ease;
      margin-top: -5px;
    }

    .volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #1db954;
      cursor: pointer;
      border-radius: 50%;
      border: none;
      transition: background-color 0.3s ease;
    }

    /* Release detail page background with fade overlay */
    #release-detail {
      position: relative;
      min-height: 100%;
      padding: 20px;
      color: #eee;
      overflow-y: auto;
      box-sizing: border-box;
    }

    #release-detail .background-fade {
      position: absolute;
      inset: 0;
      background: var(--bg-color);
      opacity: 0.7;
      filter: blur(24px);
      z-index: 0;
      border-radius: 12px;
    }

    #release-detail .content-wrapper {
      position: relative;
      z-index: 2;
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    #release-detail img {
      border-radius: 12px;
      max-width: 300px;
      object-fit: cover;
      margin-bottom: 16px;
    }

    /* Back button moved to left corner and styled */
    #release-detail button.back-btn {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 14px;
      margin-bottom: 20px;
      transition: color 0.3s ease;
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 3;
      font-weight: 600;
    }
    #release-detail button.back-btn:hover {
      color: #1db954;
    }

    #track-list > div {
      padding: 8px;
      border-bottom: 1px solid #222;
      color: #ccc;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'IBM Plex Mono', monospace;
    }

    #track-list > div:hover {
      background: #222;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h1>YZYPlayer</h1>
    <small>https://discord.gg/5qC4NQmPdv</small>
    <div class="nav-btn">
      <button onclick="showPage('home')">Home</button>
      <button onclick="showPage('liked')">Liked Songs</button>
      <button onclick="showPage('profile')">Profile</button>
      <button onclick="showPage('admin')">Admin</button>
    </div>
  </div>

  <div class="content">
    <!-- HOME -->
    <div id="home" class="page active">
      <h2>Albums</h2>
      <div id="albums"></div>
      <h2>EPs</h2>
      <div id="eps"></div>
      <h2>Singles</h2>
      <div id="singles"></div>
    </div>

    <!-- LIKED -->
    <div id="liked" class="page">
      <h2>Liked Songs</h2>
      <p>No liked songs yet.</p>
    </div>

    <!-- PROFILE -->
    <div id="profile" class="page">
      <h2>Profile</h2>
      <p>Coming soon...</p>
    </div>

    <!-- ADMIN LOGIN -->
    <div id="admin" class="page center-wrapper">
      <div id="admin-login" class="center-box">
        <h3>Admin Login</h3>
        <input
          type="password"
          id="admin-pass"
          placeholder="Enter password"
          autocomplete="off"
        />
        <button id="admin-login-btn">Login</button>
        <p id="admin-login-error" style="color:#f44336; display:none;">Incorrect password</p>
      </div>

      <div id="admin-panel" class="center-box" style="display:none;">
        <h3>Add New Release</h3>
        <select id="release-type">
          <option value="albums">Album</option>
          <option value="eps">EP</option>
          <option value="singles">Single</option>
        </select>

        <input
          type="url"
          id="release-art-url"
          placeholder="Album Art URL"
          required
        />
        <input
          type="text"
          id="release-artist-name"
          placeholder="Artist Name"
          required
        />
        <div id="tracks-container"></div>
        <button id="add-track-btn">Add Track</button>
        <button id="upload-release-btn">Upload Release</button>
        <button id="admin-logout-btn" style="margin-top:10px; background:#f44336; color:#fff;">Logout</button>
      </div>
    </div>

    <!-- RELEASE DETAIL -->
    <div id="release-detail" class="page" style="display:none;">
      <div class="background-fade"></div>
      <div class="content-wrapper">
        <button class="back-btn" onclick="closeReleaseDetail()">← Back to releases</button>
        <img id="release-art-large" src="" alt="Album Art" />
        <div id="release-artist-name" style="font-weight:700; font-size:24px; margin-bottom:8px; color:#fff;"></div>
        <div id="release-type-name" style="color:#aaa; margin-bottom:20px;"></div>
        <div id="track-list"></div>
      </div>
    </div>
  </div>

  <!-- Player Bar -->
  <div class="player-bar">
    <div class="player-top-row">
      <div class="left-controls">
        <button class="skip-back" id="prevBtn" aria-label="Previous Track">&#9664;&#9664;</button>
        <div class="track-info-short">
          <img id="player-art" src="" alt="Album Art" />
          <div class="track-info-text">
            <div id="playerTrackName" class="track-name">No Track</div>
            <div id="playerArtistName" class="artist-name">No Artist</div>
          </div>
        </div>
      </div>

      <div class="play-pause-container">
        <button id="playPauseBtn" class="play-pause-btn" aria-label="Play/Pause">&#9654;</button>
      </div>

      <button class="skip-forward" id="nextBtn" aria-label="Next Track">&#9654;&#9654;</button>
    </div>

    <div class="player-bottom-row">
      <div class="progress-container" id="progressContainer">
        <div class="progress-filled" id="progressFilled"></div>
      </div>

      <div class="volume-container">
        <input
          type="range"
          id="volumeSlider"
          min="0"
          max="1"
          step="0.01"
          value="0.8"
          class="volume-slider"
          aria-label="Volume Slider"
        />
      </div>
    </div>
  </div>

  <script>
    // Elements
    const pages = [...document.querySelectorAll('.page')];
    const albumsEl = document.getElementById('albums');
    const epsEl = document.getElementById('eps');
    const singlesEl = document.getElementById('singles');
    const likedEl = document.getElementById('liked');
    const profileEl = document.getElementById('profile');
    const adminLoginEl = document.getElementById('admin-login');
    const adminPanelEl = document.getElementById('admin-panel');
    const adminPassInput = document.getElementById('admin-pass');
    const adminLoginBtn = document.getElementById('admin-login-btn');
    const adminLoginError = document.getElementById('admin-login-error');
    const releaseDetail = document.getElementById('release-detail');
    const releaseArtLarge = document.getElementById('release-art-large');
    const releaseArtistName = document.getElementById('release-artist-name');
    const releaseTypeName = document.getElementById('release-type-name');
    const trackList = document.getElementById('track-list');
    const backBtn = releaseDetail.querySelector('.back-btn');

    // Player Elements
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playerTrackName = document.getElementById('playerTrackName');
    const playerArtistName = document.getElementById('playerArtistName');
    const playerArt = document.getElementById('player-art');
    const progressContainer = document.getElementById('progressContainer');
    const progressFilled = document.getElementById('progressFilled');
    const volumeSlider = document.getElementById('volumeSlider');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Audio
    const audio = new Audio();
    audio.volume = volumeSlider.value;

    // Data
    let releases = JSON.parse(localStorage.getItem('releases')) || {
      albums: [],
      eps: [],
      singles: [],
    };

    // Playback state
    let currentRelease = null;
    let currentTrackIndex = 0;
    let trackLoaded = false;

    // UI helpers
    function showPage(pageId) {
      pages.forEach((p) => {
        p.style.display = p.id === pageId ? '' : 'none';
        p.classList.toggle('active', p.id === pageId);
      });
      if(pageId === 'home') {
        renderAllReleases();
      }
    }

    // Render albums, eps, singles on home page
    function renderAllReleases() {
      albumsEl.innerHTML = '';
      epsEl.innerHTML = '';
      singlesEl.innerHTML = '';

      for (const [type, container] of [
        ['albums', albumsEl],
        ['eps', epsEl],
        ['singles', singlesEl],
      ]) {
        releases[type].forEach((release, i) => {
          const card = document.createElement('div');
          card.className = 'song-card';
          card.tabIndex = 0;
          card.setAttribute('role', 'button');
          card.setAttribute('aria-label', `Open ${release.artist} ${type} details`);
          card.innerHTML = `
            <img src="${release.art}" alt="Cover art for ${release.artist}" />
            <div class="artist-name">${release.artist}</div>
          `;
          card.onclick = () => openReleaseDetail(type, i);
          card.onkeydown = e => {
            if(e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              openReleaseDetail(type, i);
            }
          };
          container.appendChild(card);
        });
      }
    }

    // Open release detail page
    function openReleaseDetail(type, index) {
      currentRelease = { type, index };
      const release = releases[type][index];
      releaseArtLarge.src = release.art;
      releaseArtistName.textContent = release.artist;
      releaseTypeName.textContent = type.charAt(0).toUpperCase() + type.slice(1);
      trackList.innerHTML = '';

      release.tracks.forEach((track, i) => {
        const trackDiv = document.createElement('div');
        trackDiv.textContent = `${i + 1}. ${track}`;
        trackDiv.tabIndex = 0;
        trackDiv.setAttribute('role', 'button');
        trackDiv.setAttribute('aria-label', `Play track ${track}`);
        trackDiv.onclick = () => playTrack(i);
        trackDiv.onkeydown = e => {
          if(e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            playTrack(i);
          }
        };
        trackList.appendChild(trackDiv);
      });

      showPage('release-detail');
    }

    // Close release detail page back to home
    function closeReleaseDetail() {
      currentRelease = null;
      trackLoaded = false;
      audio.pause();
      playPauseBtn.innerHTML = '&#9654;'; // Play icon
      showPage('home');
    }

    // Play track in release detail
    function playTrack(trackIndex) {
      if (!currentRelease) return;
      const release = releases[currentRelease.type][currentRelease.index];
      const track = release.tracks[trackIndex];
      if (!track) return;

      // Assuming you have a folder structure for audio files like: "audio/albums/track.mp3"
      // For demo, we just pretend URL is `audio/{type}/{artist} - {track}.mp3` URL-safe
      const sanitizedArtist = encodeURIComponent(release.artist);
      const sanitizedTrack = encodeURIComponent(track);
      audio.src = `audio/${currentRelease.type}/${sanitizedArtist} - ${sanitizedTrack}.mp3`;
      audio.play();
      trackLoaded = true;
      currentTrackIndex = trackIndex;

      // Update player UI
      playerTrackName.textContent = track;
      playerArtistName.textContent = release.artist;
      playerArt.src = release.art;
      playPauseBtn.innerHTML = '&#10073;&#10073;'; // Pause icon

      // Scroll to top of player bar so user sees it
      window.scrollTo(0, 0);
    }

    // Play/Pause toggle with trackLoaded check
    playPauseBtn.addEventListener('click', () => {
      if (!trackLoaded) return;
      if (audio.paused) {
        audio.play();
        playPauseBtn.innerHTML = '&#10073;&#10073;'; // Pause icon
      } else {
        audio.pause();
        playPauseBtn.innerHTML = '&#9654;'; // Play icon
      }
    });

    // Volume slider
    volumeSlider.addEventListener('input', () => {
      audio.volume = volumeSlider.value;
    });

    // Progress bar update
    audio.addEventListener('timeupdate', () => {
      if (audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressFilled.style.width = `${percent}%`;
      }
    });

    // Seek on progress bar click
    progressContainer.addEventListener('click', (e) => {
      if (!audio.duration) return;
      const rect = progressContainer.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const width = rect.width;
      const percentage = clickX / width;
      audio.currentTime = audio.duration * percentage;
    });

    // Skip next and prev buttons
    prevBtn.addEventListener('click', () => {
      if (!currentRelease) return;
      if (!trackLoaded) return;
      const release = releases[currentRelease.type][currentRelease.index];
      currentTrackIndex = (currentTrackIndex - 1 + release.tracks.length) % release.tracks.length;
      playTrack(currentTrackIndex);
    });

    nextBtn.addEventListener('click', () => {
      if (!currentRelease) return;
      if (!trackLoaded) return;
      const release = releases[currentRelease.type][currentRelease.index];
      currentTrackIndex = (currentTrackIndex + 1) % release.tracks.length;
      playTrack(currentTrackIndex);
    });

    // Audio ended event, auto play next track
    audio.addEventListener('ended', () => {
      if (!currentRelease) return;
      const release = releases[currentRelease.type][currentRelease.index];
      currentTrackIndex++;
      if (currentTrackIndex >= release.tracks.length) {
        currentTrackIndex = 0; // Loop back to first track
      }
      playTrack(currentTrackIndex);
    });

    // Admin login flow (dummy password: "adminpass")
    adminLoginBtn.addEventListener('click', () => {
      const pass = adminPassInput.value;
      if (pass === 'adminpass') {
        adminLoginError.style.display = 'none';
        adminLoginEl.style.display = 'none';
        adminPanelEl.style.display = 'flex';
      } else {
        adminLoginError.style.display = 'block';
      }
    });

    document.getElementById('admin-logout-btn').addEventListener('click', () => {
      adminPassInput.value = '';
      adminLoginError.style.display = 'none';
      adminPanelEl.style.display = 'none';
      adminLoginEl.style.display = 'flex';
      showPage('admin');
    });

    // Add track input for admin panel
    const tracksContainer = document.getElementById('tracks-container');
    document.getElementById('add-track-btn').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Track Name';
      input.required = true;
      tracksContainer.appendChild(input);
    });

    // Upload release in admin panel
    document.getElementById('upload-release-btn').addEventListener('click', () => {
      const type = document.getElementById('release-type').value;
      const art = document.getElementById('release-art-url').value.trim();
      const artist = document.getElementById('release-artist-name').value.trim();
      const tracksInputs = tracksContainer.querySelectorAll('input');
      const tracks = [];

      for (const input of tracksInputs) {
        if (input.value.trim()) {
          tracks.push(input.value.trim());
        }
      }

      if (!art || !artist || tracks.length === 0) {
        alert('Please fill all fields and add at least one track.');
        return;
      }

      releases[type].push({ art, artist, tracks });
      localStorage.setItem('releases', JSON.stringify(releases));

      // Reset admin panel inputs
      document.getElementById('release-art-url').value = '';
      document.getElementById('release-artist-name').value = '';
      tracksContainer.innerHTML = '';

      alert('Release uploaded!');
      renderAllReleases();
      showPage('home');
    });

    // Initial render
    renderAllReleases();

    // Accessibility: Keyboard navigation hint
    document.body.addEventListener('keydown', (e) => {
      if(e.key === "Tab") {
        document.body.classList.add('user-is-tabbing');
      }
    });

  </script>
</body>
</html>
